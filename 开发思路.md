### 如何获取特定方法运行时间

目前有几个思路

1. （最理想，但过去的无法获取）代码里新增装饰器，输出到执行日志
2. （可以获取所有时间的，从日志里获取）获取到应用实例ID，然后拼装url，逐个get数据解析
3. （最慢的，其他和2一样）只用WebUI获取，速度会慢很多

首先来攻克2，实在不行再3

---

### 10.23更新

目前采用了方案二，运行没有问题。现在分析一下代码逻辑：

总体来说分为两个部分：

一，拿到实例ID，入参应当包含日期，时间。增加一个缓存，如果`xmlfiles`中有保存过的`xmlfiles`，那么不需要打开浏览器去取。这个大方法应该返回实例ID

二、拿到实例ID，通过get或者读文件的渠道拿到xml。

三、根据具体需求分析xml，例如分析指定方法的时间，成功率

四、展示分析结果，例如绘图

一和二可以合并成：入参给定日期和时间，返回所有指定时间段的xml

这样就是三个部分：拿xml，分析，展示

#### 抓取xml

入参应该是：<u>时间段</u>，<u>云测项目名称</u>，<u>项目中的任务名称</u>，<u>是否离线只使用文件中的xml</u>（可以先不做）

1. 根据时间段，去浏览器拿所有实例ID
2. 看文件中有没有现成的xml，如果没有，再去get
3. 如果一开始选择离线，那么直接根据每个实例ID的开始时间框定指定分析的实例ID

> 本来是想如果文件中有需要的xml，就不用打开浏览器了。问题是，如何知道，指定日期的**全部**实例ID呢？怎么知道文件中的xml是不是包含了所有需要的呢？这一点只能打开浏览器进行验证。



#### 分析 & 展示

目前的几个应用场景：

1. 分析关键字耗时，成功率
2. 分析用例耗时，成功率
3. 早上快速分析用例错误原因，大批量用例失败的时候可以快速定位一下原因
4. 

##### 分析关键字耗时，成功率

###### 给定指定关键字，得到一段时间内的某方法耗时统计，失败率。

绘图：热点图（时间相近的合并成一个点，点的大小由合并进来的数量决定），用时平均、中位数的折线图，失败的用例用一个柱状图表示，放在背景处

###### 给定关键字，统计在24小时内其方法耗时，失败率

基本同上，不过横坐标由日期改为小时，可以不平均，或者突出展示晚上的数据



##### 分析用例耗时，成功率

给定指定用例，得到一段时间以来，**晚上批跑时**的成功率



##### 分析一天内的用例成功率，关键字成功率



##### 最近一段时间各个用例的成功率





- [x] 各个逻辑提出来别放一起

  - [x] 分析xml的逻辑单独封装

    层级关系 main.py -> data Analyze -> Graph

- [x] xml分析加上是否成功

- [ ] 使用数据库

- [ ] 想个办法保存每个xml的时间

- [ ] 支持查询不同项目下的不同task

- [ ] 使用数据库查询对应的实例ID

- [ ] 底层页面操作方法抽象出来

- [ ] 

#### 表结构

一个xml中包含的**用例层级**：Suite（tcTemplate) -> Suite (E2E/charging/Apig/...) -> Suite (具体的用例名) -> Test (具体的用例名) -> keyword (关键字) 

###### 实例表

实例ID | 开始时间 | 该实例串行总时间 | 

Instance

###### 用例表

ID | 用例名 | 开始时间 | 持续时间 | 状态 | 是否成功 | 所属-实例ID | 

---

